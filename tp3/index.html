<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Les Travaux Pratiques du cours eServices"><meta name=author content="Lilia Sfaxi"><link href=http://INSATunisia.github.io/TP-eServices/tp3/ rel=canonical><link rel=icon href=../img/favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.10"><title>TP3 - Mise en Place d’un ESB avec Talend ESB - TP eServices</title><link rel=stylesheet href=../assets/stylesheets/main.d6be258b.min.css><link rel=stylesheet href=../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#e92063><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../stylesheets/extra.css><link rel=stylesheet href=../stylesheets/links.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=pink data-md-color-accent=amber> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#tp3-mise-en-place-dun-esb-avec-talend-esb class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="TP eServices" class="md-header__button md-logo" aria-label="TP eServices" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> TP eServices </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> TP3 - Mise en Place d’un ESB avec Talend ESB </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/INSATunisia/TP-eServices/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-eServices </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="TP eServices" class="md-nav__button md-logo" aria-label="TP eServices" data-md-component=logo> <img src=../img/logo.png alt=logo> </a> TP eServices </label> <div class=md-nav__source> <a href=https://github.com/INSATunisia/TP-eServices/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> INSATunisia/TP-eServices </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Travaux Pratiques eServices </a> </li> <li class=md-nav__item> <a href=../tp1/ class=md-nav__link> TP1 - Services Web REST et SOAP avec Talend </a> </li> <li class=md-nav__item> <a href=../tp2/ class=md-nav__link> TP2 - Orchestration de Services avec Camunda </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> TP3 - Mise en Place d’un ESB avec Talend ESB <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> TP3 - Mise en Place d’un ESB avec Talend ESB </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#tp3-mise-en-place-dun-esb-avec-talend-esb class=md-nav__link> TP3 - Mise en Place d’un ESB avec Talend ESB </a> <nav class=md-nav aria-label="TP3 - Mise en Place d’un ESB avec Talend ESB"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#configuration-et-utilisation-de-lesb-talend class=md-nav__link> Configuration et Utilisation de l'ESB Talend </a> <nav class=md-nav aria-label="Configuration et Utilisation de l'ESB Talend"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lancement-de-deux-instances-de-lesb-talend class=md-nav__link> Lancement de deux instances de l'ESB Talend </a> </li> <li class=md-nav__item> <a href=#publier-votre-service-dans-lesb-et-le-tester class=md-nav__link> Publier votre Service dans l'ESB et le Tester </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creation-des-routes class=md-nav__link> Création des Routes </a> <nav class=md-nav aria-label="Création des Routes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#premiere-route-filtrage-des-messages class=md-nav__link> Première Route: Filtrage des Messages </a> </li> <li class=md-nav__item> <a href=#deploiement-des-routes-sur-lesb class=md-nav__link> Déploiement des Routes sur l'ESB </a> </li> <li class=md-nav__item> <a href=#deuxieme-route-filtrage-et-modification-de-messages class=md-nav__link> Deuxième Route : Filtrage et Modification de Messages </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fonctionnalites-supplementaires-de-lesb class=md-nav__link> Fonctionnalités Supplémentaires de l'ESB </a> <nav class=md-nav aria-label="Fonctionnalités Supplémentaires de l'ESB"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#failover-et-repartition-de-charge class=md-nav__link> Failover et Répartition de Charge </a> <nav class=md-nav aria-label="Failover et Répartition de Charge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-locator class=md-nav__link> Service Locator </a> </li> <li class=md-nav__item> <a href=#configuration-du-service-locator class=md-nav__link> Configuration du Service Locator </a> <nav class=md-nav aria-label="Configuration du Service Locator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deploiement-du-sl-dans-le-contenaire class=md-nav__link> 1. Déploiement du SL dans le contenaire </a> </li> <li class=md-nav__item> <a href=#2-activer-sl-dans-le-service class=md-nav__link> 2. Activer SL dans le service </a> </li> <li class=md-nav__item> <a href=#3-activer-sl-dans-le-consommateur class=md-nav__link> 3. Activer SL dans le consommateur </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#test-du-service-locator class=md-nav__link> Test du Service Locator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-monitoring class=md-nav__link> Service Monitoring </a> </li> <li class=md-nav__item> <a href=#authentification class=md-nav__link> Authentification </a> <nav class=md-nav aria-label=Authentification> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-token-service-sts-implementation-du-ws-trust class=md-nav__link> Security Token Service (STS) : Implémentation du WS-Trust </a> </li> <li class=md-nav__item> <a href=#configuration-des-parametres-de-securite class=md-nav__link> Configuration des Paramètres de Sécurité </a> <nav class=md-nav aria-label="Configuration des Paramètres de Sécurité"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deployer-sts-dans-le-conteneur-dexecution class=md-nav__link> 1. Déployer STS dans le conteneur d’exécution </a> </li> <li class=md-nav__item> <a href=#2-configurer-les-parametres-de-securite-de-votre-conteneur class=md-nav__link> 2. Configurer les paramètres de sécurité de votre conteneur </a> </li> <li class=md-nav__item> <a href=#3-activer-sts-dans-votre-service class=md-nav__link> 3. Activer STS dans votre service </a> </li> <li class=md-nav__item> <a href=#4-configurer-le-client class=md-nav__link> 4. Configurer le client </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../tp4/ class=md-nav__link> TP4 - Microservices avec Spring Boot et Spring Cloud </a> </li> <li class=md-nav__item> <a href=../tp5/ class=md-nav__link> TP5 - API Management avec Atom et Anypoint </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#tp3-mise-en-place-dun-esb-avec-talend-esb class=md-nav__link> TP3 - Mise en Place d’un ESB avec Talend ESB </a> <nav class=md-nav aria-label="TP3 - Mise en Place d’un ESB avec Talend ESB"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#telecharger-pdf class=md-nav__link> Télécharger PDF </a> </li> <li class=md-nav__item> <a href=#objectifs-du-tp class=md-nav__link> Objectifs du TP </a> </li> <li class=md-nav__item> <a href=#outils-et-versions class=md-nav__link> Outils et Versions </a> </li> <li class=md-nav__item> <a href=#configuration-et-utilisation-de-lesb-talend class=md-nav__link> Configuration et Utilisation de l'ESB Talend </a> <nav class=md-nav aria-label="Configuration et Utilisation de l'ESB Talend"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lancement-de-deux-instances-de-lesb-talend class=md-nav__link> Lancement de deux instances de l'ESB Talend </a> </li> <li class=md-nav__item> <a href=#publier-votre-service-dans-lesb-et-le-tester class=md-nav__link> Publier votre Service dans l'ESB et le Tester </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creation-des-routes class=md-nav__link> Création des Routes </a> <nav class=md-nav aria-label="Création des Routes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#premiere-route-filtrage-des-messages class=md-nav__link> Première Route: Filtrage des Messages </a> </li> <li class=md-nav__item> <a href=#deploiement-des-routes-sur-lesb class=md-nav__link> Déploiement des Routes sur l'ESB </a> </li> <li class=md-nav__item> <a href=#deuxieme-route-filtrage-et-modification-de-messages class=md-nav__link> Deuxième Route : Filtrage et Modification de Messages </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fonctionnalites-supplementaires-de-lesb class=md-nav__link> Fonctionnalités Supplémentaires de l'ESB </a> <nav class=md-nav aria-label="Fonctionnalités Supplémentaires de l'ESB"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#failover-et-repartition-de-charge class=md-nav__link> Failover et Répartition de Charge </a> <nav class=md-nav aria-label="Failover et Répartition de Charge"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#service-locator class=md-nav__link> Service Locator </a> </li> <li class=md-nav__item> <a href=#configuration-du-service-locator class=md-nav__link> Configuration du Service Locator </a> <nav class=md-nav aria-label="Configuration du Service Locator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deploiement-du-sl-dans-le-contenaire class=md-nav__link> 1. Déploiement du SL dans le contenaire </a> </li> <li class=md-nav__item> <a href=#2-activer-sl-dans-le-service class=md-nav__link> 2. Activer SL dans le service </a> </li> <li class=md-nav__item> <a href=#3-activer-sl-dans-le-consommateur class=md-nav__link> 3. Activer SL dans le consommateur </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#test-du-service-locator class=md-nav__link> Test du Service Locator </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#service-monitoring class=md-nav__link> Service Monitoring </a> </li> <li class=md-nav__item> <a href=#authentification class=md-nav__link> Authentification </a> <nav class=md-nav aria-label=Authentification> <ul class=md-nav__list> <li class=md-nav__item> <a href=#security-token-service-sts-implementation-du-ws-trust class=md-nav__link> Security Token Service (STS) : Implémentation du WS-Trust </a> </li> <li class=md-nav__item> <a href=#configuration-des-parametres-de-securite class=md-nav__link> Configuration des Paramètres de Sécurité </a> <nav class=md-nav aria-label="Configuration des Paramètres de Sécurité"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-deployer-sts-dans-le-conteneur-dexecution class=md-nav__link> 1. Déployer STS dans le conteneur d’exécution </a> </li> <li class=md-nav__item> <a href=#2-configurer-les-parametres-de-securite-de-votre-conteneur class=md-nav__link> 2. Configurer les paramètres de sécurité de votre conteneur </a> </li> <li class=md-nav__item> <a href=#3-activer-sts-dans-votre-service class=md-nav__link> 3. Activer STS dans votre service </a> </li> <li class=md-nav__item> <a href=#4-configurer-le-client class=md-nav__link> 4. Configurer le client </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/INSATunisia/TP-eServices/edit/master/docs/tp3.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>TP3 - Mise en Place d’un ESB avec Talend ESB</h1> <h2 id=tp3-mise-en-place-dun-esb-avec-talend-esb>TP3 - Mise en Place d’un ESB avec Talend ESB<a class=headerlink href=#tp3-mise-en-place-dun-esb-avec-talend-esb title="Permanent link">&para;</a></h2> <p><img alt=ESB src=../img/esb.png></p> <h3 id=telecharger-pdf>Télécharger PDF<a class=headerlink href=#telecharger-pdf title="Permanent link">&para;</a></h3> <p><a href=../tp3.pdf><img alt="Download TP3" src=../img/pdf.png></a></p> <h3 id=objectifs-du-tp>Objectifs du TP<a class=headerlink href=#objectifs-du-tp title="Permanent link">&para;</a></h3> <ol> <li>Routage, médiation et transformation avec Talend ESB.</li> <li>Gestion du failover et répartition de charges, monitoring et authentification avec Talend ESB.</li> </ol> <h3 id=outils-et-versions>Outils et Versions<a class=headerlink href=#outils-et-versions title="Permanent link">&para;</a></h3> <ul> <li><a href=https://www.talend.com/download_page_type/talend-open-studio/ >Talend Open Studio for ESB</a> Version: 6.3.0</li> <li><a href=https://www.dbvis.com/download/ >DB Visualizer</a> Version 10.0</li> <li><a href=http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html>Java</a> Version 1.8.0_121</li> </ul> <h3 id=configuration-et-utilisation-de-lesb-talend>Configuration et Utilisation de l'ESB Talend<a class=headerlink href=#configuration-et-utilisation-de-lesb-talend title="Permanent link">&para;</a></h3> <h4 id=lancement-de-deux-instances-de-lesb-talend>Lancement de deux instances de l'ESB Talend<a class=headerlink href=#lancement-de-deux-instances-de-lesb-talend title="Permanent link">&para;</a></h4> <p>Pour les besoins de notre TP, nous allons lancer deux instances de l’ESB Talend. Pour cela, l’environnement nous fournit une manière très simple de le faire:</p> <ul> <li>Aller dans le répertoire <em>&lt;rep_install_talend>/Runtime_ESBSE</em></li> <li>Copier le répertoire <em>container</em> et le renommer en <em>alternate-container</em>.</li> </ul> <p>Nous allons maintenant configurer la deuxième instance de l’ESB (dans <em>alternate-container</em>) pour qu’elle se lance sur un port différent de la première. Pour cela:</p> <ul> <li><strong>Lancer l’ESB</strong> : dans le répertoire <em>alternate-container</em> que vous venez de créer, aller vers <em>bin</em> et exécuter <em>trun.bash</em> (sur windows). Si vous êtes sur Linux ou mac, placez-vous sous le répertoire <em>alternate-container/bin</em> et lancer dans un terminal la commande <em>./trun</em>. La fenêtre suivante devrait s’afficher:</li> </ul> <p><center><img src=../img/tp3/run-ESB2.png></center></p> <div class="admonition warning"> <p class=admonition-title>Attention</p> <p>Le premier contenaire ne doit pas être en exécution, sinon il y'aura un conflit d'adresses. Il faut d'abord configurer le second contenaire pour qu'il se lance sur un port différent, ce que nous allons faire dans l'étape suivante.</p> </div> <ul> <li><strong>Configurer l'ESB</strong> : dans l’invite de commande affichée, taper:</li> </ul> <div class=highlight><pre><span></span><code>  <span class=nb>source</span> scripts/configureC1.sh
</code></pre></div> <ul> <li>Un affichage tel que le suivant va apparaître:</li> </ul> <p><center><img src=../img/tp3/config-ESB2.png></center></p> <p>Vous avez ainsi créé un ESB, que vous avez configuré pour se lancer sur le port 8041, alors que, par défaut, il devrait se lancer sur le port 8040. Si vous voulez créer une troisième instance, vous pouvez la configurer en utilisant le fichier configureC2.sh, de même pour une quatrième instance… Pour revenir à la configuration par défaut, utiliser configureC0.sh.</p> <ul> <li>Arrêtez votre ESB, en cliquant sur ctrl-d, et relancez-le de nouveau.</li> <li>Lancez dans un autre terminal l’instance de l’ESB se trouvant sous le répertoire d’origine container. Il est inutile de la configurer, elle se lancera par défaut sur le port 8040.</li> </ul> <h4 id=publier-votre-service-dans-lesb-et-le-tester>Publier votre Service dans l'ESB et le Tester<a class=headerlink href=#publier-votre-service-dans-lesb-et-le-tester title="Permanent link">&para;</a></h4> <p>Revenir au service web SOAP <a href=../tp1/#service-web-soap-helloworld>HelloWorldService</a> que vous avez créé dans le TP1, et le publier sur l'ESB. Pour cela, ouvrir l'éditeur <em>Talend Open Studio</em> sur le projet <em>Helloworld</em>, et suivre les étapes suivantes:</p> <ul> <li>Faire un clic-droit sur le service <em>HelloWorldService</em> et choisir <em>Exporter le service</em>. Choisir comme répertoire de destination le dossier <em>deploy</em> se trouvant dans le conteneur où vous désirez déployer le service. Un fichier archive de type kar sera alors créé sous ce répertoire, permettant ainsi son déploiement à chaud (pas besoin de redémarrer l’ESB).</li> <li>Déployer votre service sur les deux instances d’ESB que vous avez démarré.</li> <li>Vérifier que vos services sont actifs:<ul> <li>en tapant <em>list</em> dans vos deux instances d’ESB</li> <li>en affichant les fichiers WSDL du service sur les ports 8040 et 8041 au lieu de 8090.</li> </ul> </li> </ul> <p>Pour tester votre service web:</p> <ul> <li>Dans le job consommateur de service, dans les propriétés du composant tESBConsumer, modifier le port du endpoint de 8090 à 8040</li> <li>Lancer votre job. Vérifier que l’affichage se fait correctement sur la console du TOS-ESB.</li> </ul> <p>Vérifier que votre service s’exécute bien sur l’ESB principal, en consultant le terminal où il est démarré. Vous devriez trouver un affichage semblable à celui-ci:</p> <p><center><img src=../img/tp3/service-exec.png></center></p> <h3 id=creation-des-routes>Création des Routes<a class=headerlink href=#creation-des-routes title="Permanent link">&para;</a></h3> <p>Les routes permettent de définir le comportement que doit prendre le message selon son contenu. Dans notre exemple, nous allons définir deux types de routes: une route permettant de filtrer les messages par contenu, en envoyant les messages contenant le nom “Alice” vers un ESB, et le reste vers l’autre ESB. Une deuxième route permettra de modifier le contenu de certains messages avant de les faire parvenir à leurs destinataires.</p> <h4 id=premiere-route-filtrage-des-messages>Première Route: Filtrage des Messages<a class=headerlink href=#premiere-route-filtrage-des-messages title="Permanent link">&para;</a></h4> <ul> <li>Créer une nouvelle route en cliquant-droit sur <em>Routes -&gt; Créer une Route</em>. Nous allons l’appeler FiltrageRoute.</li> <li>Définir votre route de manière à ce qu’elle ressemble à ce qui suit:</li> </ul> <p><center><img src=../img/tp3/filtrage-route.png></center></p> <ul> <li> <p>Les composants utilisés sont:</p> <ul> <li><strong>cCXF</strong> : fournit l'intégration avec Apache CXF pour la connexion aux services JAX-WS.</li> <li><strong>MessageRouter</strong> : route des messages dans différents canaux selon des conditions spécifiées.</li> </ul> </li> <li> <p>Configurer la condition <em>when</em>, en précisant que c’est une condition de type simple, dont le texte est :</p> </li> </ul> <p><div class=highlight><pre><span></span><code>    <span class=s2>&quot;</span><span class=si>${</span><span class=nv>bodyAs</span><span class=p>(String)</span><span class=si>}</span><span class=s2> contains &#39;Alice&#39;&quot;</span>
</code></pre></div> Cela veut dire que, si le corps du message contient <em>Alice</em>, la requête sera routée vers le composant <em>cCXF_2</em>.</p> <ul> <li> <p>Configurer le composant cCXF_1:</p> <ul> <li>Adresse: <a href=http://localhost:8042/services/HelloWorldService>http://localhost:8042/services/HelloWorldService</a></li> <li>WSDL: <a href=http://localhost:8040/services/HelloWorldService?WSDL>http://localhost:8040/services/HelloWorldService?WSDL</a>.</li> </ul> </li> </ul> <div class="admonition tip"> <p class=admonition-title>Remarque</p> <p>Remarquez ici que le port utilisé pour l'adresse est 8042: c'est le port choisi pour le service façade fourni par la route. Le WSDL utilisé, par contre, est celui du service initial, exposé sur le port 8040, donc sur le premier ESB.</p> </div> <ul> <li>Configurer l’adresse de cCXF_2 sur le port 8040, et celle de cCXF_3 sur le port 8041, tout en gardant le même WSDL pour les trois composants.</li> <li>Lancer la route pour la tester. La console devra afficher <em>connected</em>.</li> </ul> <p>Pour utiliser cette route, vous devez reconfigurer votre consommateur pour qu’il lance sa requête sur le port 8042. Exécutez-le et observez le résultat sur les terminaux des deux instances d’ESB démarrées. Que constatez-vous?</p> <h4 id=deploiement-des-routes-sur-lesb>Déploiement des Routes sur l'ESB<a class=headerlink href=#deploiement-des-routes-sur-lesb title="Permanent link">&para;</a></h4> <p>Dans leur état actuel, vos routes doivent être lancées manuellement pour être prises en considération. Pour les déployer sur votre ESB et les garder ainsi toujours actives, suivre les étapes suivantes:</p> <ul> <li>Faites un clic-droit sur votre route et sélectionner: <em>Build Route</em> (veillez à ce que le job FiltrageRoute soit bien arrêté).</li> <li>Choisir le répertoire deploy du conteneur de votre choix.</li> <li>Tester votre route en exécutant à nouveau le consommateur.</li> </ul> <div class="admonition warning"> <p class=admonition-title>Attention</p> <p>Vous ne devez en aucun cas déployer votre route sur deux contenaires, sinon, il y'aura un conflit, car deux services façades seront exposés, ayant la même adresse.</p> </div> <h4 id=deuxieme-route-filtrage-et-modification-de-messages>Deuxième Route : Filtrage et Modification de Messages<a class=headerlink href=#deuxieme-route-filtrage-et-modification-de-messages title="Permanent link">&para;</a></h4> <p>Dans cette nouvelle partie, nous allons modifier le corps du message après l’avoir filtré. Pour cela:</p> <ul> <li>Dans Talend Studio, dupliquer votre route <em>FiltrageRoute</em> et la nommer <em>ModificationRoute</em>.</li> <li>Insérer un composant <em>cSetBody</em> (permettant de modifier le corps du message reçu) puis un composant <em>cProcessor</em> (permettant de remanier rapidement du code dans la route) entre le <em>cMessageRouter</em> et le <em>cCXF_3</em>. Le but ici est de modifier le corps des messages reçus, selon leur contenu. Le résultat obtenu ressemblera au suivant:</li> </ul> <p><center><img src=../img/tp3/modification-route.png></center></p> <ul> <li>Insérer le code suivant (de type Xpath) dans le <em>cSetBody</em> :</li> </ul> <div class=highlight><pre><span></span><code>  &quot;tns:HelloWorldServiceOperationRequest/in&quot;
</code></pre></div> <p>Ceci permet de saisir le contenu de la balise <em>in</em> de la requête SOAP envoyée par le consommateur. Il ne faut pas oublier de définir le Namespace <em>tns</em> (<a href=http://www.talend.org/service/ >http://www.talend.org/service/</a>).</p> <ul> <li>Insérer le code suivant dans le processeur:</li> </ul> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>exchange</span><span class=p>.</span><span class=na>getIn</span><span class=p>().</span><span class=na>getBody</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
<span class=n>String</span> <span class=n>surname</span><span class=p>;</span>
<span class=k>if</span> <span class=p>(</span><span class=n>name</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;Bob&quot;</span><span class=p>)){</span>
  <span class=n>surname</span> <span class=o>=</span> <span class=s>&quot;Bobby&quot;</span><span class=p>;</span>
<span class=p>}</span><span class=k>else</span><span class=p>{</span>
  <span class=n>surname</span> <span class=o>=</span> <span class=s>&quot;Chucky&quot;</span><span class=p>;</span>
<span class=p>}</span>
<span class=n>exchange</span><span class=p>.</span><span class=na>getIn</span><span class=p>().</span><span class=na>setBody</span><span class=p>(</span><span class=s>&quot;&lt;tns:HelloWorldServiceOperationRequest &quot;</span><span class=o>+</span>
    <span class=s>&quot;xmlns:tns=\&quot;http://www.talend.org/service/\&quot;&gt;&lt;in&gt;&quot;</span>
    <span class=o>+</span><span class=n>surname</span><span class=o>+</span><span class=s>&quot;&lt;/in&gt; &lt;/tns:HelloWorldServiceOperationRequest&gt;&quot;</span><span class=p>);</span>
</code></pre></div> <p>Ce code permet de modifier le corps du message entrant en remplaçant le nom par un surnom.</p> <ul> <li>Modifier l'adresse du composant <em>cCXF_1</em> pour qu'il se lance sur le port 8043.</li> <li>Sauvegarder et exporter votre route dans l’ESB. Lancer le consommateur de nouveau et observez le résultat.</li> </ul> <h3 id=fonctionnalites-supplementaires-de-lesb>Fonctionnalités Supplémentaires de l'ESB<a class=headerlink href=#fonctionnalites-supplementaires-de-lesb title="Permanent link">&para;</a></h3> <h4 id=failover-et-repartition-de-charge>Failover et Répartition de Charge<a class=headerlink href=#failover-et-repartition-de-charge title="Permanent link">&para;</a></h4> <h5 id=service-locator>Service Locator<a class=headerlink href=#service-locator title="Permanent link">&para;</a></h5> <p>Via le Service Locator, l'ESB de Talend fournit des fonctionnalités de gestion de failover automatique et transparente ainsi que de répartition de charge via le lookup et l'enregistrement d'endpoints dynamiques dans Apache Zookeeper. Le Service Locator maintient la disponibilité du service afin de répondre aux demandes et aux Service Level Agreements (SLAs).</p> <h5 id=configuration-du-service-locator>Configuration du Service Locator<a class=headerlink href=#configuration-du-service-locator title="Permanent link">&para;</a></h5> <p>Pour activer le service locator (SL), il faut:</p> <ol> <li>Déployer SL au niveau des conteneurs d’exécution Talend</li> <li>Activer la prise en compte du SL au niveau du service cible</li> <li>Configurer le consommateur du service pour prendre en compte le SL</li> </ol> <h6 id=1-deploiement-du-sl-dans-le-contenaire>1. Déploiement du SL dans le contenaire<a class=headerlink href=#1-deploiement-du-sl-dans-le-contenaire title="Permanent link">&para;</a></h6> <p>Pour tester sa capacité à gérer le failover et la répartition des charges, le SL doit être déployé dans les différents conteneurs de services où sera déployé votre service. Pour cela, taper dans l’invite de commande de chaque conteneur ESB:</p> <div class=highlight><pre><span></span><code><span class=na>  tesb</span><span class=o>:</span><span class=s>start-locator</span><span class=w></span>
</code></pre></div> <p>Il est possible de visualiser votre SL dans la liste des services déployés sur le conteneur en tapant list sur votre terminal. Vous devriez trouver les lignes suivantes:</p> <p><center><img src=../img/tp3/activ-locator.png></center></p> <h6 id=2-activer-sl-dans-le-service>2. Activer SL dans le service<a class=headerlink href=#2-activer-sl-dans-le-service title="Permanent link">&para;</a></h6> <p>Pour activer la prise en compte de SL au niveau de notre service utilisateur dans Talend Studio:</p> <ul> <li>Clic-droit sur le service</li> <li>Choisir <em>ESB Runtime Options</em></li> <li>Cocher la case <em>"Utiliser le Service Locator"</em></li> </ul> <p>Il faut veiller à re-déployer votre service dans les deux conteneurs après l’activation de la fonctionnalité.</p> <h6 id=3-activer-sl-dans-le-consommateur>3. Activer SL dans le consommateur<a class=headerlink href=#3-activer-sl-dans-le-consommateur title="Permanent link">&para;</a></h6> <p>Au niveau du consommateur du service, dans les propriétés du composant tESB, cocher la case <em>Use Service Locator</em>.</p> <h5 id=test-du-service-locator>Test du Service Locator<a class=headerlink href=#test-du-service-locator title="Permanent link">&para;</a></h5> <p><em>Pour tester la répartition de charges</em> : Lancer le consommateur plusieurs fois sur le port 8040 et observez le résultat.</p> <p><em>Pour tester la gestion du failover</em> : Arrêter le service sur le contenaire principal (8040). Pour cela, dans l'invite de commande du contenaire principal, taper <em>list</em>, puis chercher l'identifiant du service <em>HelloWorldService</em>. Taper ensuite : <em>stop &lt;id_service></em>. Lancer le consommateur sur le endpoint 8040, et observez le résultat.</p> <h4 id=service-monitoring>Service Monitoring<a class=headerlink href=#service-monitoring title="Permanent link">&para;</a></h4> <p>Le composant SAM permet le logging et la surveillance des appels de service, réalisés avec le framework Apache CXF. Il peut être utilisé pour collecter, par exemple, les statistiques d’usage et le monitoring des fautes.</p> <p>Pour configurer le Service Activity Monitoring:</p> <ol> <li> <p>Déployer SAM au niveau du conteneur d’exécution Talend. Pour cela, taper : <div class=highlight><pre><span></span><code><span class=na>tesb</span><span class=o>:</span><span class=s>start-sam</span><span class=w></span>
</code></pre></div> Vous remarquerez qu’une base de données Derby sera également déployée sur le conteneur: elle permet de stocker les informations sur l’activité des services.</p> </li> <li> <p>Activer la prise en compte de SAM au niveau du service cible</p> </li> <li>Configurer le consommateur du service pour prendre en compte le SAM</li> </ol> <p>Pour visualiser le résultat de la surveillance, utiliser un visualiseur de bases de données, tel que <a href=https://www.dbvis.com/download/ >Db Visualizer</a>.</p> <p>Pour accéder à la base de données de monitoring, utiliser les paramètres de configuration suivants:</p> <ul> <li><em>Database connection configuration (Default)</em>: Derby/JavaDB</li> <li><em>Driver</em>: JavaDB/Derby Server</li> <li><em>Database Server</em>: localhost</li> <li><em>Database Port</em>: 1527</li> <li><em>Database</em>: DB</li> <li><em>DB username</em>: test</li> <li><em>DB password</em>: test</li> </ul> <p>Exécuter votre service plusieurs fois, et observer le résultat.</p> <h4 id=authentification>Authentification<a class=headerlink href=#authentification title="Permanent link">&para;</a></h4> <h5 id=security-token-service-sts-implementation-du-ws-trust>Security Token Service (STS) : Implémentation du WS-Trust<a class=headerlink href=#security-token-service-sts-implementation-du-ws-trust title="Permanent link">&para;</a></h5> <p>Dans un environnement hétérogène, les services web doivent authentifier les services clients pour contrôler leur accès, grâce à la norme WS-Security, et en implémentant le WS-Trust. <em>"Trust"</em> veut dire <em>"Confiance"</em>: le but ici est donc d’établir un lien de confiance entre le consommateur et le fournisseur.</p> <p>Pour cela, un courtier d’authentification est utilisé, fournissant un contrôle d’accès pour les applications. Ce courtier délivre des jetons de sécurité utilisés par les clients pour s’authentifier au service.</p> <p>Le STS (<em>Security Token Service</em>) est un service web qui fournit un tel courtier d’authentification. Ses jetons respectent le standard WS-Trust. Il offre les fonctionnalités suivantes:</p> <ul> <li>Délivrer un jeton de sécurité basé sur des paramètres d’authentification configurés.</li> <li>Vérifier la validité d’un paramètre d’authentification</li> <li>Renouveler un jeton de sécurité</li> <li>Annuler un jeton de sécurité</li> <li>Transformer un jeton de sécurité donné en un autre de type différent.</li> </ul> <p>L’utilisation d’un STS simplifie grandement la gestion de la sécurité pour le service et le client, car ils n’ont qu’à faire appel à ce STS, qui va gérer la logique de sécurité, au lieu de la traiter eux-mêmes.</p> <h5 id=configuration-des-parametres-de-securite>Configuration des Paramètres de Sécurité<a class=headerlink href=#configuration-des-parametres-de-securite title="Permanent link">&para;</a></h5> <p>Pour associer des paramètres de confidentialité à un service, il faut suivre les étapes suivantes:</p> <ol> <li>Déployer STS dans le conteneur d’exécution Talend</li> <li>Configurer les paramètres de sécurité de votre conteneur</li> <li>Activer la prise en compte de STS dans votre service</li> <li>Configurer votre client pour saisir les paramètres d’authentification.</li> </ol> <h6 id=1-deployer-sts-dans-le-conteneur-dexecution>1. Déployer STS dans le conteneur d’exécution<a class=headerlink href=#1-deployer-sts-dans-le-conteneur-dexecution title="Permanent link">&para;</a></h6> <p>Pour installer le service STS dans votre conteneur, démarrer ce dernier, et taper l’instruction suivante dans le terminal: <div class=highlight><pre><span></span><code><span class=na>    feature</span><span class=o>:</span><span class=s>install tesb-sts</span><span class=w></span>
</code></pre></div></p> <p>Si le service a bien été installé, vous pouvez vérifier qu’il est bien démarré en exécutant la commande : <em>list</em>. Vous devriez trouver les lignes suivantes:</p> <p><center><img src=../img/tp3/activ-sts.png></center></p> <h6 id=2-configurer-les-parametres-de-securite-de-votre-conteneur>2. Configurer les paramètres de sécurité de votre conteneur<a class=headerlink href=#2-configurer-les-parametres-de-securite-de-votre-conteneur title="Permanent link">&para;</a></h6> <p>Comme c’est le STS qui prend en charge le contrôle d’accès, les paramètres d’authentification (le login/mdp par exemple) ne sont pas configurés au niveau du service fournisseur, mais au niveau du conteneur lui-même.</p> <p>Pour visualiser l’ensemble des utilisateurs autorisés sur votre conteneur, voir leurs mots de passes et rôles, et éventuellement en ajouter de nouveaux, ouvrir le fichier: <em>&lt;conteneur>/etc/users.properties</em>.</p> <p>Dans ce fichier, les informations d'authentification sont sous la forme: <em>user=password,group</em>. Ajouter une nouvelle ligne avec votre nom comme user et un mot de passe de votre choix, et choisir le groupe <em>admin</em>.</p> <h6 id=3-activer-sts-dans-votre-service>3. Activer STS dans votre service<a class=headerlink href=#3-activer-sts-dans-votre-service title="Permanent link">&para;</a></h6> <p>Pour activer la prise en compte de STS au niveau de notre service utilisateur dans Talend Studio, dans <em>ESB Runtime Options</em>, cocher le type d’authentification désiré (dans notre cas, <em>Identifiant/Mot de passe</em>)</p> <h6 id=4-configurer-le-client>4. Configurer le client<a class=headerlink href=#4-configurer-le-client title="Permanent link">&para;</a></h6> <p>Pour insérer le login/mdp dans votre application cliente, modifier les paramètres d’authentification de votre composant tESBConsumer dans votre job consommateur.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class=timeago datetime=2020-02-02T17:51:04+01:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2020-02-02</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../tp2/ class="md-footer__link md-footer__link--prev" aria-label="Previous: TP2 - Orchestration de Services avec Camunda" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> TP2 - Orchestration de Services avec Camunda </div> </div> </a> <a href=../tp4/ class="md-footer__link md-footer__link--next" aria-label="Next: TP4 - Microservices avec Spring Boot et Spring Cloud" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> TP4 - Microservices avec Spring Boot et Spring Cloud </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2017 - 2018 Lilia Sfaxi </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script> <script src=../assets/javascripts/bundle.e3b2bf44.min.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> </body> </html>